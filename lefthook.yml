# Lefthook configuration
# https://github.com/evilmartians/lefthook

# コミット前に実行するフック
pre-commit:
  parallel: true
  commands:
    # Prettierでフォーマットチェック
    format:
      glob: "**/*.{js,jsx,ts,tsx,json,css,md}"
      run: npx prettier --check {staged_files}
      stage_fixed: true

    # ESLintでコードチェック
    lint:
      glob: "**/*.{js,jsx,ts,tsx}"
      run: npx eslint {staged_files}

    # TypeScriptの型チェック
    type-check:
      run: npm run type-check

# コミットメッセージの検証
commit-msg:
  commands:
    # Conventional Commitsフォーマットのチェック
    message-format:
      run: |
        commit_msg=$(cat {1})
        pattern="^(feat|fix|docs|style|refactor|test|chore|perf|ci|build|revert)(\(.+\))?: .{1,}"

        if ! echo "$commit_msg" | grep -qE "$pattern"; then
          echo "❌ Commit message does not follow Conventional Commits format"
          echo ""
          echo "Format: <type>(<scope>): <subject>"
          echo ""
          echo "Types:"
          echo "  feat:     新機能の追加"
          echo "  fix:      バグ修正"
          echo "  docs:     ドキュメントの変更"
          echo "  style:    コードスタイルの変更（機能に影響なし）"
          echo "  refactor: リファクタリング"
          echo "  test:     テストの追加・修正"
          echo "  chore:    ビルドプロセスやツールの変更"
          echo "  perf:     パフォーマンス改善"
          echo "  ci:       CI設定の変更"
          echo "  build:    ビルドシステムの変更"
          echo "  revert:   コミットの取り消し"
          echo ""
          echo "Example: feat(auth): add login functionality"
          exit 1
        fi

# プッシュ前に実行するフック
pre-push:
  commands:
    # テストを実行
    test:
      run: npm run test -- --run --reporter=verbose

    # ビルドチェック
    build-check:
      run: npm run build

# スキップ用の設定（必要に応じて使用）
# コミット時にスキップする場合: LEFTHOOK=0 git commit -m "message"
# または: git commit -m "message" --no-verify

# 特定のコマンドをスキップする場合の設定例
# skip_output:
#   - meta
#   - summary
